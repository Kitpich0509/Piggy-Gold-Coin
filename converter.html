<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Currency Converter ‚Äî Live Ticker</title>
  <style>
    :root{
      --brand:#2193b0;
      --card:#fff;
      --bg1:#2193b0;
      --bg2:#6dd5ed;
    }
    html,body{height:100%;margin:0;font-family:'Segoe UI',Tahoma,Arial;}
    body{
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      padding:24px;
    }

    .container{
      width:100%;
      max-width:480px;
      background:var(--card);
      border-radius:18px;
      box-shadow:0 12px 30px rgba(0,0,0,0.18);
      padding:22px;
      box-sizing:border-box;
      text-align:center;
    }

    h1{
      margin:6px 0 12px;
      color:var(--brand);
      font-size:22px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }

    /* running ticker */
    .ticker-wrapper{
      width:100%;
      overflow:hidden;
      white-space:nowrap;
      margin:6px 0 18px;
      box-sizing:border-box;
      border-radius:10px;
      background:linear-gradient(90deg, rgba(33,147,176,0.06), rgba(109,213,237,0.04));
      padding:8px 6px;
      border:1px solid rgba(33,147,176,0.08);
    }

    .ticker {
      display:inline-block;
      padding-left:100%;
      /* start off-screen */
      animation: scroll-left 12s linear infinite;
      font-weight:600;
      color:#0f4a57;
      font-size:14px;
      align-items:center;
    }

    @keyframes scroll-left {
      0% { transform: translateX(0%); }
      100% { transform: translateX(-100%); }
    }

    .live-dot {
      display:inline-block;
      width:12px;height:12px;border-radius:50%;
      margin-left:8px;
      vertical-align:middle;
      position:relative;
      background:#2ecc71; /* green */
      box-shadow:0 0 6px rgba(46,204,113,0.9);
      animation: pulse 1.4s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity:1; }
      50% { transform: scale(1.3); opacity:0.7; }
      100% { transform: scale(1); opacity:1; }
    }

    /* converter card */
    .form {
      text-align:left;
      gap:12px;
      display:grid;
      grid-template-columns:1fr;
    }
    label { font-size:13px;color:#333;font-weight:700;margin-bottom:6px; display:block; }
    input, select {
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid #e6eef2;
      font-size:15px;
      box-sizing:border-box;
      outline:none;
    }
    input:focus, select:focus { border-color:var(--brand); box-shadow:0 4px 12px rgba(33,147,176,0.06); }
    .btn {
      margin-top:12px;
      width:100%;
      padding:12px;
      background:var(--brand);
      color:#fff;
      border:none;
      border-radius:10px;
      font-size:16px;
      cursor:pointer;
      font-weight:700;
    }
    .result {
      margin-top:14px;
      font-size:18px;
      font-weight:800;
      text-align:center;
      color:#0b3b43;
      padding:10px;
      border-radius:10px;
      background:#f3fdff;
      border:1px dashed rgba(33,147,176,0.12);
    }

    /* small screens */
    @media (max-width:420px){
      .ticker { font-size:13px; animation-duration:14s; }
      h1 { font-size:20px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üí± Currency Converter</h1>

    <!-- Running sentence / ticker under H1 -->
    <div class="ticker-wrapper" aria-hidden="false">
      <div id="ticker" class="ticker">
        Loading live exchange rate... <span class="live-dot" id="liveDot"></span>
      </div>
    </div>

    <!-- Converter form -->
    <div class="form">
      <div>
        <label for="amount">Amount</label>
        <input id="amount" type="number" placeholder="e.g. 100" value="100" />
      </div>

      <div>
        <label for="from">From</label>
        <select id="from"></select>
      </div>

      <div>
        <label for="to">To</label>
        <select id="to"></select>
      </div>

      <button class="btn" id="convertBtn">üîÑ Convert</button>

      <div id="result" class="result">Result will appear here</div>
    </div>
  </div>

  <script>
    // API base (open, no key)
    const apiBase = 'https://open.er-api.com/v6/latest/';
    let currentRates = {}; // rates from last fetch (base = selected from currency)

    // load currencies (using USD as initial base)
    async function loadCurrencies() {
      try {
        const res = await fetch(apiBase + 'USD');
        const json = await res.json();
        if (json.result !== 'success') throw new Error('API error');
        const rates = json.rates;
        const keys = Object.keys(rates).sort();

        const fromEl = document.getElementById('from');
        const toEl = document.getElementById('to');

        // populate selects
        keys.forEach(k => {
          fromEl.insertAdjacentHTML('beforeend', `<option value="${k}">${k}</option>`);
          toEl.insertAdjacentHTML('beforeend', `<option value="${k}">${k}</option>`);
        });

        fromEl.value = 'USD';
        toEl.value = 'KHR';

        // load initial rates for ticker
        await updateRatesAndTicker();
      } catch (err) {
        document.getElementById('ticker').textContent = '‚ùå Failed to load currencies.';
      }
    }

    // Helper: format numbers with space thousand separator, 2 decimals
    function formatSpace(num) {
      return new Intl.NumberFormat('fr-FR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(num);
    }

    // update rates (fetch using base = from currency), then update ticker text
    async function updateRatesAndTicker() {
      try {
        const from = document.getElementById('from').value || 'USD';
        const to = document.getElementById('to').value || 'KHR';
        const res = await fetch(apiBase + encodeURIComponent(from));
        const json = await res.json();
        if (json.result !== 'success') throw new Error('API error');
        currentRates = json.rates; // rates relative to base 'from'

        // If target rate exists, show live sentence
        const rate = currentRates[to];
        if (rate) {
          // example: "Live: 1 USD = 4 010.94 KHR" with live dot
          const formatted = formatSpace(rate);
          const tickerText = `Live: 1 ${from} = ${formatted} ${to} `;
          setTickerText(tickerText);
        } else {
          setTickerText('Live rate not available for selected pair.');
        }
      } catch (err) {
        setTickerText('‚ùå Unable to fetch live rate.');
      }
    }

    // set ticker content and restart animation (so text length restarts)
    function setTickerText(text) {
      const ticker = document.getElementById('ticker');
      // include the live-dot HTML at end so the pulse remains
      ticker.innerHTML = text + '<span class="live-dot" id="liveDot"></span>';
      // restart CSS animation by cloning node (simple trick)
      ticker.style.animation = 'none';
      // Force reflow
      void ticker.offsetWidth;
      ticker.style.animation = null;
    }

    // Convert button behavior: uses currentRates (base = from)
    function convertNow() {
      const amount = parseFloat(document.getElementById('amount').value);
      const from = document.getElementById('from').value;
      const to = document.getElementById('to').value;
      const resultEl = document.getElementById('result');

      if (!amount || amount <= 0) {
        resultEl.textContent = '‚ö†Ô∏è Enter a valid amount';
        return;
      }
      if (!currentRates || typeof currentRates[to] === 'undefined') {
        resultEl.textContent = '‚ùå Rate not available ‚Äî try again in a moment.';
        return;
      }

      const rate = currentRates[to];
      const converted = amount * rate;
      resultEl.textContent = `${amount} ${from} = ${formatSpace(converted)} ${to}`;
    }

    // event listeners
    document.getElementById('convertBtn').addEventListener('click', convertNow);

    // when user changes pair, update rates & ticker immediately
    document.getElementById('from').addEventListener('change', async () => {
      // fetch rates using new base
      await updateRatesAndTicker();
    });
    document.getElementById('to').addEventListener('change', async () => {
      await updateRatesAndTicker();
    });

    // periodic updater: refresh rates & ticker every 10 seconds
    let periodicId = null;
    async function startPeriodic() {
      if (periodicId) clearInterval(periodicId);
      periodicId = setInterval(updateRatesAndTicker, 10000); // 10s
    }

    // initial load
    (async function init(){
      await loadCurrencies();
      startPeriodic();
    })();
  </script>
</body>
</html>
